name: Backend CI

on:
  pull_request:
    paths:
      - 'backend/**'
      - '.github/workflows/backend-ci.yml'
      - '!apidef/**'
      - '!migration/**'

env:
  CARGO_TERM_COLOR: always
  RUSTFLAGS: "-Dwarnings"

jobs:
  build:
    name: Build
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up buildx
        uses: docker/setup-buildx-action@v3

      - name: Build
        run: |
          cp backend/.env.example backend/.env
          docker compose build
          docker compose up -d

      - name: Run tests
        run: |
          docker compose exec backend /bin/sh -c "cd backend && cargo test --all-features"






